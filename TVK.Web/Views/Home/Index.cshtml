@model TVK.Web.Models.TvkCommand
@using Microsoft.EntityFrameworkCore;
@using System.Security.Claims;


@{
    ViewData["Title"] = "Главная";
    var address = Model?.Address ?? "http://192.168.56.1:5000/api/command";
    var command = Model?.Command ?? "hostname";

    testSQLContext db = new testSQLContext();
    Users user = db.Users
        .Where(t => t.Email == User.FindFirst(x => x.Type == ClaimsIdentity.DefaultNameClaimType).Value)
    .FirstOrDefault();



    var backgroundCommand = db.BackgroundCommand.ToList();
    List<string> data = new List<string>();

    DateTime start = new DateTime();
}


    <div class="text-center">
        <h1 class="display-4">Welcome @user.Nameusers</h1>
        <form method="post" action="/home/post">
            <p>
                <label for="address">Address:</label> <input type="text" name="address" id="address" value="@address" />
            </p>
            <p>
                <label for="command">Command: </label>
                <select name="command" id="command">
                    @foreach (var bakcommand in backgroundCommand)
                    {
                        <option title="@bakcommand.Help">@bakcommand.Command</option>
                    }
                </select>
            </p>
            <p>
                <input type="submit" value="Run" />
            </p>

            <table class="mytable">
                <thead>
                    <tr><th>Команды</th></tr>
                </thead>
                <tbody>
                    @foreach (var bakcommand in backgroundCommand)
                    {
                        <tr><td>@bakcommand.Command </td><td>@bakcommand.Help</td></tr>
                    }
                </tbody>
            </table>
            <br />
            <br />
            @if (!string.IsNullOrEmpty(Model?.Data))
            {
                start = DateTime.Now;
                data.AddRange(Model.Data.Split("\n"));
                <table class="mytable">
                    <tbody>
                        @foreach (var a in data)
                        {
                            <tr><td>@a.Trim('\r')</td></tr>
                        }
                        <tr><td>Время отправки команды</td><td>@start</td></tr>
                        <tr><td>Время ответа команды</td><td>@DateTime.Now</td></tr>
                        <tr><td>Время выполнения команды</td><td>@(DateTime.Now - start)</td></tr>
                    </tbody>
                </table>

            }
        </form>

        <fieldset>
            <legend>Json systeminfo</legend>
            <form>
                Address <input type="text" value="192.168.0.30:5000" id="address_systeminfo" />
                <input type="button" value="Выполнить" id="button_Get_systeminfo" />
                <br />
                <span id="result"> </span>
            </form>
        </fieldset>


    </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

        $(document).ready(function(){
		$('#button_Get_systeminfo').click( function(){
            var address = $('#address_systeminfo').val();
			$.ajax({
				type: 'GET',
				url: '/get_systeminfo/' + address,
                success: function (result) {
                    var s = '';
                    s += '<br>Загрузка процессора: ' + result.loadPercentage;
                    s += '<br>Количество ядер: ' + result.numberOfCores;
                    s += '<br>Количество потоков: ' + result.numberOfLogicalProcessors;
                    s += '<br>Количество оперативной памяти MB: ' + result.totalVisibleMemorySize;
                    s += '<br>Количество свободной оперативной памяти MB: ' + result.freePhysicalMemory;
                    s += '<br>------------------';
					$('#result').html(s);
				}
			});
		});

        })
    console.log("hello json");
</script>